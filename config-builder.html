<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alliance DAO Config Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0D0D0D;
            color: #E5E7EB;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #2dd4bf;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(45, 212, 191, 0.3);
        }

        .tab {
            padding: 12px 24px;
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            border-radius: 8px 8px 0 0;
        }

        .tab:hover {
            background: rgba(31, 41, 55, 0.7);
        }

        .tab.active {
            background: #2dd4bf;
            color: #0D0D0D;
            border-color: #2dd4bf;
        }

        .section {
            display: none;
            background: rgba(31, 41, 55, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0 12px 12px 12px;
            padding: 30px;
        }

        .section.active {
            display: block;
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(13, 13, 13, 0.5);
            border-radius: 8px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-size: 0.9em;
            color: #2dd4bf;
            font-weight: 500;
        }

        input, select {
            padding: 10px;
            background: rgba(31, 41, 55, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #E5E7EB;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #2dd4bf;
            background: rgba(31, 41, 55, 0.9);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: #2dd4bf;
            color: #0D0D0D;
        }

        .btn-primary:hover {
            background: #14b8a6;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(31, 41, 55, 0.7);
            color: #E5E7EB;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(31, 41, 55, 0.9);
        }

        .btn-danger {
            background: #DC2626;
            color: white;
        }

        .btn-danger:hover {
            background: #991B1B;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .list-container {
            margin-top: 30px;
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .list-header h3 {
            color: #2dd4bf;
        }

        .search-box {
            padding: 8px 12px;
            background: rgba(31, 41, 55, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #E5E7EB;
            width: 300px;
        }

        .items-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .item-card {
            background: rgba(13, 13, 13, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
            transition: all 0.3s;
        }

        .item-card:hover {
            border-color: #2dd4bf;
            background: rgba(13, 13, 13, 0.7);
        }

        .item-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .item-name {
            font-weight: 600;
            color: #2dd4bf;
            font-size: 1.1em;
        }

        .item-detail {
            font-size: 0.85em;
            color: #9CA3AF;
            font-family: 'Courier New', monospace;
        }

        .item-badge {
            display: inline-block;
            padding: 3px 8px;
            background: rgba(45, 212, 191, 0.2);
            color: #2dd4bf;
            border-radius: 4px;
            font-size: 0.75em;
            margin-top: 5px;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .export-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(13, 13, 13, 0.5);
            border-radius: 8px;
            border: 2px solid #2dd4bf;
        }

        .export-section h3 {
            color: #2dd4bf;
            margin-bottom: 15px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(45, 212, 191, 0.1);
            border: 1px solid rgba(45, 212, 191, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2dd4bf;
        }

        .stat-label {
            font-size: 0.9em;
            color: #9CA3AF;
            margin-top: 5px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2dd4bf;
            color: #0D0D0D;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .subcategory-header {
            margin-top: 30px;
            margin-bottom: 15px;
            color: #2dd4bf;
            font-size: 1.2em;
            border-bottom: 1px solid rgba(45, 212, 191, 0.3);
            padding-bottom: 10px;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(31, 41, 55, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #2dd4bf;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #14b8a6;
        }
    </style>
</head>
<body>
    <!-- Header with Navigation -->
    <header class="max-w-screen-2xl mx-auto mb-8 flex justify-between items-center px-4" style="padding: 20px 0;">
        <a href="index.html" style="display: inline-block; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">
            <img src="https://raw.githubusercontent.com/defipatriot/aDAO-Image-Files/main/Alliance%20DAO%20Logo.png" 
                 alt="Alliance DAO Logo" 
                 style="height: 48px; width: auto; cursor: pointer;"
                 title="Return to TX Explorer">
        </a>
        <h1 style="font-size: 1.875rem; font-weight: 700; color: white; text-align: center; margin: 0;">Config Builder</h1>
        <img src="https://raw.githubusercontent.com/defipatriot/aDAO-Image-Planets-Empty/main/Terra.PNG" 
             alt="Terra Logo" 
             style="height: 48px; width: auto;">
    </header>

    <!-- Sub-Navigation -->
    <div style="max-width: 1400px; margin: 0 auto; padding: 0 20px 20px;">
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem;">
            <a href="index.html" style="padding: 0.75rem 1.5rem; background-color: #374151; color: #d1d5db; font-weight: 600; border-radius: 0.5rem; text-decoration: none; border: 1px solid #4b5563; transition: all 0.2s;">Transaction Explorer</a>
            <a href="config-builder.html" style="padding: 0.75rem 1.5rem; background-color: #2dd4bf; color: #0D0D0D; font-weight: 600; border-radius: 0.5rem; text-decoration: none; border: 1px solid #2dd4bf; box-shadow: 0 0 15px rgba(45, 212, 191, 0.5); pointer-events: none;">Config Builder</a>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('members')">üë• Members</div>
            <div class="tab" onclick="switchTab('addresses')">üìç Known Addresses</div>
            <div class="tab" onclick="switchTab('tokens')">üíé Tokens</div>
            <div class="tab" onclick="switchTab('export')">üì§ Export Config</div>
        </div>

        <!-- MEMBERS SECTION -->
        <div id="members" class="section active">
            <!-- Quick Import at Top -->
            <div style="background: rgba(45, 212, 191, 0.1); border: 1px solid rgba(45, 212, 191, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="color: #2dd4bf; margin-bottom: 5px;">üì• Quick Import</h3>
                        <p style="color: #9CA3AF; font-size: 0.9em; margin: 0;">Load your existing config.json to continue editing</p>
                    </div>
                    <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">üìÇ Import Config</button>
                </div>
            </div>
            
            <h2 style="margin-bottom: 20px;">Add Member</h2>
            <div class="form-group">
                <div class="input-group">
                    <label>Handle / Display Name *</label>
                    <input type="text" id="member-handle" placeholder="e.g., DeFiPatriot, 4719">
                </div>
                <div class="input-group">
                    <label>Terra Address *</label>
                    <input type="text" id="member-address" placeholder="terra1...">
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" onclick="addMember()">‚ûï Add Member</button>
                <button class="btn btn-secondary" onclick="clearMemberForm()">üîÑ Clear</button>
            </div>

            <div class="list-container">
                <div class="list-header">
                    <h3>Members List (<span id="member-count">0</span>)</h3>
                    <input type="text" class="search-box" placeholder="üîç Search members..." onkeyup="filterMembers(this.value)">
                </div>
                <div class="items-list" id="members-list"></div>
            </div>
        </div>

        <!-- KNOWN ADDRESSES SECTION -->
        <div id="addresses" class="section">
            <h2 style="margin-bottom: 20px;">Add Known Address</h2>
            <div class="form-group">
                <div class="input-group">
                    <label>Type *</label>
                    <select id="address-type">
                        <option value="platform">Platform</option>
                        <option value="validator">Validator</option>
                        <option value="dao">DAO</option>
                        <option value="contract">Contract</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Name *</label>
                    <input type="text" id="address-name" placeholder="e.g., BackBoneLabs, Orion.Money">
                </div>
                <div class="input-group">
                    <label>Address *</label>
                    <input type="text" id="address-value" placeholder="terra1... or terravaloper1...">
                </div>
                <div class="input-group">
                    <label>Logo Link (Optional)</label>
                    <input type="text" id="address-logo" placeholder="https://...">
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" onclick="addAddress()">‚ûï Add Address</button>
                <button class="btn btn-secondary" onclick="clearAddressForm()">üîÑ Clear</button>
            </div>

            <!-- Platforms -->
            <div class="subcategory-header">üè™ Platforms</div>
            <div class="list-header">
                <span>Count: <span id="platform-count">0</span></span>
                <input type="text" class="search-box" placeholder="üîç Search platforms..." onkeyup="filterAddresses('platform', this.value)">
            </div>
            <div class="items-list" id="platforms-list"></div>

            <!-- Validators -->
            <div class="subcategory-header">‚úÖ Validators</div>
            <div class="list-header">
                <span>Count: <span id="validator-count">0</span></span>
                <input type="text" class="search-box" placeholder="üîç Search validators..." onkeyup="filterAddresses('validator', this.value)">
            </div>
            <div class="items-list" id="validators-list"></div>

            <!-- DAOs -->
            <div class="subcategory-header">üèõÔ∏è DAOs</div>
            <div class="list-header">
                <span>Count: <span id="dao-count">0</span></span>
                <input type="text" class="search-box" placeholder="üîç Search DAOs..." onkeyup="filterAddresses('dao', this.value)">
            </div>
            <div class="items-list" id="daos-list"></div>

            <!-- Contracts -->
            <div class="subcategory-header">üìú Contracts</div>
            <div class="list-header">
                <span>Count: <span id="contract-count">0</span></span>
                <input type="text" class="search-box" placeholder="üîç Search contracts..." onkeyup="filterAddresses('contract', this.value)">
            </div>
            <div class="items-list" id="contracts-list"></div>
        </div>

        <!-- TOKENS SECTION -->
        <div id="tokens" class="section">
            <h2 style="margin-bottom: 20px;">Add Token</h2>
            <div class="form-group">
                <div class="input-group">
                    <label>Token Name *</label>
                    <input type="text" id="token-name" placeholder="e.g., LUNA, bLUNA">
                </div>
                <div class="input-group">
                    <label>Symbol *</label>
                    <input type="text" id="token-symbol" placeholder="e.g., LUNA">
                </div>
                <div class="input-group">
                    <label>Address / Denom *</label>
                    <input type="text" id="token-address" placeholder="uluna, terra1..., or ibc/...">
                </div>
                <div class="input-group">
                    <label>Decimals</label>
                    <input type="number" id="token-decimals" value="6" min="0" max="18">
                </div>
                <div class="input-group">
                    <label>Logo Link (Optional)</label>
                    <input type="text" id="token-logo" placeholder="https://...">
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" onclick="addToken()">‚ûï Add Token</button>
                <button class="btn btn-secondary" onclick="clearTokenForm()">üîÑ Clear</button>
            </div>

            <div class="list-container">
                <div class="list-header">
                    <h3>Tokens List (<span id="token-count">0</span>)</h3>
                    <input type="text" class="search-box" placeholder="üîç Search tokens..." onkeyup="filterTokens(this.value)">
                </div>
                <div class="items-list" id="tokens-list"></div>
            </div>
        </div>

        <!-- KNOWN BLOCKS SECTION -->
        <!-- EXPORT SECTION -->
        <div id="export" class="section">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-members">0</div>
                    <div class="stat-label">Members</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-addresses">0</div>
                    <div class="stat-label">Known Addresses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-tokens">0</div>
                    <div class="stat-label">Tokens</div>
                </div>
            </div>

            <div class="export-section">
                <h3>üì¶ Export Configuration</h3>
                <p style="color: #9CA3AF; margin-bottom: 20px;">
                    Export your configuration as a JSON file. All entries are automatically sorted alphabetically.
                </p>
                <div class="actions">
                    <button class="btn btn-primary" onclick="exportJSON()">üíæ Download alliance-dao-config.json</button>
                    <button class="btn btn-secondary" onclick="copyJSON()">üìã Copy to Clipboard</button>
                    <button class="btn btn-secondary" onclick="previewJSON()">üëÅÔ∏è Preview JSON</button>
                </div>
            </div>

            <div class="export-section" style="margin-top: 20px;">
                <h3>üì• Import Configuration</h3>
                <p style="color: #9CA3AF; margin-bottom: 20px;">
                    Load an existing configuration file to continue editing.
                </p>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importJSON(event)">
                <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">üìÇ Load Existing Config</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // Data storage
        let configData = {
            version: "1.0.0",
            last_updated: new Date().toISOString().split('T')[0],
            members: {},
            known_addresses: {
                platforms: {},
                validators: {},
                daos: {},
                contracts: {}
            },
            tokens: {}
        };

        // Load from localStorage on startup
        window.onload = function() {
            const saved = localStorage.getItem('alliance-dao-config');
            if (saved) {
                try {
                    configData = JSON.parse(saved);
                    renderAll();
                    showToast('üìÇ Loaded saved configuration');
                } catch (e) {
                    console.error('Error loading saved config:', e);
                }
            }
        };

        // Auto-save to localStorage
        function saveToLocalStorage() {
            configData.last_updated = new Date().toISOString().split('T')[0];
            localStorage.setItem('alliance-dao-config', JSON.stringify(configData));
        }

        // Convert GitHub page URLs to raw URLs
        function convertToRawGitHubUrl(url) {
            if (!url) return url;
            
            // Convert github.com/.../blob/... to raw.githubusercontent.com/...
            if (url.includes('github.com') && url.includes('/blob/')) {
                return url
                    .replace('github.com', 'raw.githubusercontent.com')
                    .replace('/blob/', '/');
            }
            
            return url;
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'export') {
                updateStats();
            }
        }

        // MEMBERS FUNCTIONS
        function addMember() {
            const handle = document.getElementById('member-handle').value.trim();
            const address = document.getElementById('member-address').value.trim();

            if (!handle || !address) {
                showToast('‚ö†Ô∏è Please fill in all required fields', 'error');
                return;
            }

            // Check for duplicate address
            if (configData.members[address]) {
                showToast('‚ö†Ô∏è This address already exists! Edit or delete it first.', 'error');
                return;
            }

            // Check for duplicate handle
            const existingHandle = Object.values(configData.members).find(m => m.handle === handle);
            if (existingHandle) {
                showToast('‚ö†Ô∏è This handle already exists! Use a different name.', 'error');
                return;
            }

            configData.members[address] = {
                handle: handle,
                address: address
            };

            saveToLocalStorage();
            renderMembers();
            clearMemberForm();
            showToast('‚úÖ Member added successfully');
        }

        function editMember(address) {
            const member = configData.members[address];
            document.getElementById('member-handle').value = member.handle;
            document.getElementById('member-address').value = member.address;
            
            // Change button to update mode
            const addBtn = document.querySelector('#members .btn-primary');
            addBtn.textContent = 'üíæ Update Member';
            addBtn.onclick = function() {
                updateMember(address);
            };
            
            showToast('‚úèÔ∏è Editing member - click Update when done');
            window.scrollTo(0, 0);
        }

        function updateMember(oldAddress) {
            const handle = document.getElementById('member-handle').value.trim();
            const address = document.getElementById('member-address').value.trim();

            if (!handle || !address) {
                showToast('‚ö†Ô∏è Please fill in all required fields', 'error');
                return;
            }

            // If address changed, check for duplicates
            if (address !== oldAddress && configData.members[address]) {
                showToast('‚ö†Ô∏è This address already exists!', 'error');
                return;
            }

            // Delete old entry if address changed
            if (address !== oldAddress) {
                delete configData.members[oldAddress];
            }

            configData.members[address] = {
                handle: handle,
                address: address
            };

            saveToLocalStorage();
            renderMembers();
            clearMemberForm();
            
            // Reset button to add mode
            const addBtn = document.querySelector('#members .btn-primary');
            addBtn.textContent = '‚ûï Add Member';
            addBtn.onclick = addMember;
            
            showToast('‚úÖ Member updated successfully');
        }

        function clearMemberForm() {
            document.getElementById('member-handle').value = '';
            document.getElementById('member-address').value = '';
        }

        function renderMembers() {
            const list = document.getElementById('members-list');
            const sorted = Object.values(configData.members).sort((a, b) => 
                a.handle.toLowerCase().localeCompare(b.handle.toLowerCase())
            );

            list.innerHTML = sorted.map(member => `
                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name">${member.handle}</div>
                        <div class="item-detail">${member.address}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-secondary" onclick="editMember('${member.address}')">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="deleteMember('${member.address}')">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');

            document.getElementById('member-count').textContent = sorted.length;
        }

        function deleteMember(address) {
            if (confirm('Delete this member?')) {
                delete configData.members[address];
                saveToLocalStorage();
                renderMembers();
                showToast('üóëÔ∏è Member deleted');
            }
        }

        function filterMembers(query) {
            const cards = document.querySelectorAll('#members-list .item-card');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query.toLowerCase()) ? 'grid' : 'none';
            });
        }

        // ADDRESSES FUNCTIONS
        function addAddress() {
            const type = document.getElementById('address-type').value;
            const name = document.getElementById('address-name').value.trim();
            const address = document.getElementById('address-value').value.trim();
            let logo = document.getElementById('address-logo').value.trim();
            
            // Auto-convert GitHub URLs to raw URLs
            logo = convertToRawGitHubUrl(logo);

            if (!name || !address) {
                showToast('‚ö†Ô∏è Please fill in all required fields', 'error');
                return;
            }

            const typeKey = type + 's'; // platforms, validators, daos, contracts
            
            // Check for duplicate address
            if (configData.known_addresses[typeKey][address]) {
                showToast('‚ö†Ô∏è This address already exists in this category!', 'error');
                return;
            }

            configData.known_addresses[typeKey][address] = {
                name: name,
                address: address,
                type: type,
                logo: logo || null
            };

            saveToLocalStorage();
            renderAddresses();
            clearAddressForm();
            showToast('‚úÖ Address added successfully');
        }

        function editAddress(type, address) {
            const addr = configData.known_addresses[type][address];
            document.getElementById('address-type').value = addr.type;
            document.getElementById('address-name').value = addr.name;
            document.getElementById('address-value').value = addr.address;
            document.getElementById('address-logo').value = addr.logo || '';
            
            // Change button to update mode
            const addBtn = document.querySelector('#addresses .btn-primary');
            addBtn.textContent = 'üíæ Update Address';
            addBtn.onclick = function() {
                updateAddress(type, address);
            };
            
            showToast('‚úèÔ∏è Editing address - click Update when done');
            switchTab('addresses');
            window.scrollTo(0, 0);
        }

        function updateAddress(oldType, oldAddress) {
            const type = document.getElementById('address-type').value;
            const name = document.getElementById('address-name').value.trim();
            const address = document.getElementById('address-value').value.trim();
            let logo = document.getElementById('address-logo').value.trim();
            
            // Auto-convert GitHub URLs to raw URLs
            logo = convertToRawGitHubUrl(logo);

            if (!name || !address) {
                showToast('‚ö†Ô∏è Please fill in all required fields', 'error');
                return;
            }

            const typeKey = type + 's';
            const oldTypeKey = oldType + 's';

            // Delete old entry
            delete configData.known_addresses[oldTypeKey][oldAddress];

            // Add new/updated entry
            configData.known_addresses[typeKey][address] = {
                name: name,
                address: address,
                type: type,
                logo: logo || null
            };

            saveToLocalStorage();
            renderAddresses();
            clearAddressForm();
            
            // Reset button
            const addBtn = document.querySelector('#addresses .btn-primary');
            addBtn.textContent = '‚ûï Add Address';
            addBtn.onclick = addAddress;
            
            showToast('‚úÖ Address updated successfully');
        }

        function clearAddressForm() {
            document.getElementById('address-name').value = '';
            document.getElementById('address-value').value = '';
            document.getElementById('address-logo').value = '';
        }

        function renderAddresses() {
            const types = ['platforms', 'validators', 'daos', 'contracts'];
            
            types.forEach(type => {
                const list = document.getElementById(`${type}-list`);
                const sorted = Object.values(configData.known_addresses[type]).sort((a, b) => 
                    a.name.toLowerCase().localeCompare(b.name.toLowerCase())
                );

                list.innerHTML = sorted.map(addr => `
                    <div class="item-card">
                        <div class="item-info">
                            <div class="item-name">${addr.name}</div>
                            <div class="item-detail">${addr.address}</div>
                            ${addr.logo ? `<div class="item-badge">üì∏ Has Logo</div>` : ''}
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-small btn-secondary" onclick="editAddress('${type}', '${addr.address}')">‚úèÔ∏è Edit</button>
                            <button class="btn btn-small btn-danger" onclick="deleteAddress('${type}', '${addr.address}')">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `).join('');

                document.getElementById(`${type.slice(0, -1)}-count`).textContent = sorted.length;
            });
        }

        function deleteAddress(type, address) {
            if (confirm('Delete this address?')) {
                delete configData.known_addresses[type][address];
                saveToLocalStorage();
                renderAddresses();
                showToast('üóëÔ∏è Address deleted');
            }
        }

        function filterAddresses(type, query) {
            const cards = document.querySelectorAll(`#${type}s-list .item-card`);
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query.toLowerCase()) ? 'grid' : 'none';
            });
        }

        // TOKENS FUNCTIONS
        function addToken() {
            const name = document.getElementById('token-name').value.trim();
            const symbol = document.getElementById('token-symbol').value.trim();
            const address = document.getElementById('token-address').value.trim();
            const decimals = parseInt(document.getElementById('token-decimals').value);
            let logo = document.getElementById('token-logo').value.trim();
            
            // Auto-convert GitHub URLs to raw URLs
            logo = convertToRawGitHubUrl(logo);

            if (!name || !symbol || !address) {
                showToast('‚ö†Ô∏è Please fill in all required fields', 'error');
                return;
            }

            // Check for duplicate address
            if (configData.tokens[address]) {
                showToast('‚ö†Ô∏è This token address already exists!', 'error');
                return;
            }

            configData.tokens[address] = {
                name: name,
                symbol: symbol,
                address: address,
                decimals: decimals,
                logo: logo || null
            };

            saveToLocalStorage();
            renderTokens();
            clearTokenForm();
            showToast('‚úÖ Token added successfully');
        }

        function editToken(address) {
            const token = configData.tokens[address];
            document.getElementById('token-name').value = token.name;
            document.getElementById('token-symbol').value = token.symbol;
            document.getElementById('token-address').value = token.address;
            document.getElementById('token-decimals').value = token.decimals;
            document.getElementById('token-logo').value = token.logo || '';
            
            // Change button to update mode
            const addBtn = document.querySelector('#tokens .btn-primary');
            addBtn.textContent = 'üíæ Update Token';
            addBtn.onclick = function() {
                updateToken(address);
            };
            
            showToast('‚úèÔ∏è Editing token - click Update when done');
            window.scrollTo(0, 0);
        }

        function updateToken(oldAddress) {
            const name = document.getElementById('token-name').value.trim();
            const symbol = document.getElementById('token-symbol').value.trim();
            const address = document.getElementById('token-address').value.trim();
            const decimals = parseInt(document.getElementById('token-decimals').value);
            let logo = document.getElementById('token-logo').value.trim();
            
            // Auto-convert GitHub URLs to raw URLs
            logo = convertToRawGitHubUrl(logo);

            if (!name || !symbol || !address) {
                showToast('‚ö†Ô∏è Please fill in all required fields', 'error');
                return;
            }

            // Delete old entry if address changed
            if (address !== oldAddress) {
                if (configData.tokens[address]) {
                    showToast('‚ö†Ô∏è This address already exists!', 'error');
                    return;
                }
                delete configData.tokens[oldAddress];
            }

            configData.tokens[address] = {
                name: name,
                symbol: symbol,
                address: address,
                decimals: decimals,
                logo: logo || null
            };

            saveToLocalStorage();
            renderTokens();
            clearTokenForm();
            
            // Reset button
            const addBtn = document.querySelector('#tokens .btn-primary');
            addBtn.textContent = '‚ûï Add Token';
            addBtn.onclick = addToken;
            
            showToast('‚úÖ Token updated successfully');
        }

        function clearTokenForm() {
            document.getElementById('token-name').value = '';
            document.getElementById('token-symbol').value = '';
            document.getElementById('token-address').value = '';
            document.getElementById('token-decimals').value = '6';
            document.getElementById('token-logo').value = '';
        }

        function renderTokens() {
            const list = document.getElementById('tokens-list');
            const sorted = Object.values(configData.tokens).sort((a, b) => 
                a.name.toLowerCase().localeCompare(b.name.toLowerCase())
            );

            list.innerHTML = sorted.map(token => `
                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name">${token.name} (${token.symbol})</div>
                        <div class="item-detail">${token.address}</div>
                        <div class="item-badge">Decimals: ${token.decimals}</div>
                        ${token.logo ? `<div class="item-badge">üì∏ Has Logo</div>` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-secondary" onclick="editToken('${token.address}')">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="deleteToken('${token.address}')">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');

            document.getElementById('token-count').textContent = sorted.length;
        }

        function deleteToken(address) {
            if (confirm('Delete this token?')) {
                delete configData.tokens[address];
                saveToLocalStorage();
                renderTokens();
                showToast('üóëÔ∏è Token deleted');
            }
        }

        function filterTokens(query) {
            const cards = document.querySelectorAll('#tokens-list .item-card');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query.toLowerCase()) ? 'grid' : 'none';
            });
        }

        // KNOWN BLOCKS FUNCTIONS
        function addBlock() {
            const height = document.getElementById('block-height').value.trim();
            const timestamp = document.getElementById('block-timestamp').value;
            const eventType = document.getElementById('block-event-type').value;
            const description = document.getElementById('block-description').value.trim();

            if (!height || !timestamp || !eventType) {
                showToast('‚ö†Ô∏è Please fill in all required fields', 'error');
                return;
            }

            // Check for duplicate block height
            if (configData.known_blocks[height]) {
                showToast('‚ö†Ô∏è This block height already exists!', 'error');
                return;
            }

            configData.known_blocks[height] = {
                height: parseInt(height),
                timestamp: timestamp,
                event_type: eventType,
                description: description || null
            };

            saveToLocalStorage();
            renderBlocks();
            clearBlockForm();
            showToast('‚úÖ Block added successfully');
        }

        function clearBlockForm() {
            document.getElementById('block-height').value = '';
            document.getElementById('block-timestamp').value = '';
            document.getElementById('block-event-type').value = '';
            document.getElementById('block-description').value = '';
        }

        function renderBlocks() {
            const list = document.getElementById('blocks-list');
            // Sort by timestamp (newest first)
            const sorted = Object.values(configData.known_blocks).sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );

            list.innerHTML = sorted.map(block => {
                const date = new Date(block.timestamp);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                return `
                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name">Block #${block.height.toLocaleString()}</div>
                        <div class="item-detail">üìÖ ${formattedDate}</div>
                        <div class="item-badge">${block.event_type}</div>
                        ${block.description ? `<div style="color: #9CA3AF; font-size: 0.85em; margin-top: 5px;">${block.description}</div>` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-secondary" onclick="editBlock('${block.height}')">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="deleteBlock('${block.height}')">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `}).join('');

            document.getElementById('block-count').textContent = sorted.length;
        }

        function editBlock(height) {
            const block = configData.known_blocks[height];
            document.getElementById('block-height').value = block.height;
            document.getElementById('block-timestamp').value = block.timestamp;
            document.getElementById('block-event-type').value = block.event_type;
            document.getElementById('block-description').value = block.description || '';
            
            // Change button to update mode
            const addBtn = document.querySelector('#blocks .btn-primary');
            addBtn.textContent = 'üíæ Update Block';
            addBtn.onclick = function() {
                updateBlock(height);
            };
            
            showToast('‚úèÔ∏è Editing block - click Update when done');
            window.scrollTo(0, 0);
        }

        function updateBlock(oldHeight) {
            const height = document.getElementById('block-height').value.trim();
            const timestamp = document.getElementById('block-timestamp').value;
            const eventType = document.getElementById('block-event-type').value;
            const description = document.getElementById('block-description').value.trim();

            if (!height || !timestamp || !eventType) {
                showToast('‚ö†Ô∏è Please fill in all required fields', 'error');
                return;
            }

            // Delete old entry if height changed
            if (height !== oldHeight) {
                if (configData.known_blocks[height]) {
                    showToast('‚ö†Ô∏è This block height already exists!', 'error');
                    return;
                }
                delete configData.known_blocks[oldHeight];
            }

            configData.known_blocks[height] = {
                height: parseInt(height),
                timestamp: timestamp,
                event_type: eventType,
                description: description || null
            };

            saveToLocalStorage();
            renderBlocks();
            clearBlockForm();
            
            // Reset button
            const addBtn = document.querySelector('#blocks .btn-primary');
            addBtn.textContent = '‚ûï Add Block';
            addBtn.onclick = addBlock;
            
            showToast('‚úÖ Block updated successfully');
        }

        function deleteBlock(height) {
            if (confirm('Delete this block?')) {
                delete configData.known_blocks[height];
                saveToLocalStorage();
                renderBlocks();
                showToast('üóëÔ∏è Block deleted');
            }
        }

        function filterBlocks(query) {
            const cards = document.querySelectorAll('#blocks-list .item-card');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query.toLowerCase()) ? 'grid' : 'none';
            });
        }

        // EXPORT FUNCTIONS
        function updateStats() {
            document.getElementById('total-members').textContent = Object.keys(configData.members).length;
            
            const totalAddresses = Object.values(configData.known_addresses).reduce((sum, category) => 
                sum + Object.keys(category).length, 0
            );
            document.getElementById('total-addresses').textContent = totalAddresses;
            
            document.getElementById('total-tokens').textContent = Object.keys(configData.tokens).length;
        }

        function exportJSON() {
            const json = JSON.stringify(configData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'alliance-dao-config.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('üíæ Configuration exported!');
        }

        function copyJSON() {
            const json = JSON.stringify(configData, null, 2);
            navigator.clipboard.writeText(json).then(() => {
                showToast('üìã Copied to clipboard!');
            });
        }

        function previewJSON() {
            const json = JSON.stringify(configData, null, 2);
            const newWindow = window.open('', '_blank');
            newWindow.document.write('<pre style="background: #1a1a1a; color: #2dd4bf; padding: 20px; font-family: monospace;">' + json + '</pre>');
        }

        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    // Ask user if they want to merge or replace
                    const hasExistingData = Object.keys(configData.members).length > 0 ||
                                          Object.keys(configData.tokens).length > 0 ||
                                          Object.keys(configData.known_blocks || {}).length > 0 ||
                                          Object.values(configData.known_addresses).some(cat => Object.keys(cat).length > 0);
                    
                    if (hasExistingData) {
                        const merge = confirm('You have existing data. Click OK to MERGE with imported data, or Cancel to REPLACE all data.');
                        
                        if (merge) {
                            // Merge members
                            configData.members = { ...configData.members, ...imported.members };
                            
                            // Merge addresses
                            if (imported.known_addresses) {
                                configData.known_addresses.platforms = { ...configData.known_addresses.platforms, ...imported.known_addresses.platforms };
                                configData.known_addresses.validators = { ...configData.known_addresses.validators, ...imported.known_addresses.validators };
                                configData.known_addresses.daos = { ...configData.known_addresses.daos, ...imported.known_addresses.daos };
                                configData.known_addresses.contracts = { ...configData.known_addresses.contracts, ...imported.known_addresses.contracts };
                            }
                            
                            // Merge tokens
                            configData.tokens = { ...configData.tokens, ...imported.tokens };
                            
                            // Merge blocks
                            if (imported.known_blocks) {
                                configData.known_blocks = { ...configData.known_blocks, ...imported.known_blocks };
                            }
                            
                            showToast('üì• Configuration merged successfully!');
                        } else {
                            configData = imported;
                            // Ensure known_blocks exists
                            if (!configData.known_blocks) {
                                configData.known_blocks = {};
                            }
                            showToast('üì• Configuration replaced successfully!');
                        }
                    } else {
                        configData = imported;
                        // Ensure known_blocks exists
                        if (!configData.known_blocks) {
                            configData.known_blocks = {};
                        }
                        showToast('üì• Configuration imported successfully!');
                    }
                    
                    saveToLocalStorage();
                    renderAll();
                } catch (error) {
                    showToast('‚ùå Error importing file: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // UTILITY FUNCTIONS
        function renderAll() {
            renderMembers();
            renderAddresses();
            renderTokens();
            renderBlocks();
            updateStats();
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'error' ? '#DC2626' : '#2dd4bf';
            toast.style.color = type === 'error' ? 'white' : '#0D0D0D';
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize
        renderAll();
    </script>
</body>
</html>
